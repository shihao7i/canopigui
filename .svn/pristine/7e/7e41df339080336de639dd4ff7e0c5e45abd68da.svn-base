angular.module('admin.app').controller('ActivitySearchController', 
        [ '$scope', '$log', '$filter', 'activityTypes', 'AdminJsonService', 'UiGridUtilService',
        function ($scope, $log, $filter, activityTypes, AdminJsonService, UiGridUtilService) {
            
	'use strict';
	
        var vm = this;
 
        init();
        
        function init() {
            
  	    initializeVMVariables();
 	    setupVMMethods();
            
        };
        
        function  initializeVMVariables() {

            // sort the rule category values in ascending order
            vm.activityTypes = $filter('orderBy')(activityTypes, 'name');
            vm.searchAccordionOpen = true;
            
            // set maxDate to today's date
            vm.maxDate = new Date();

            
        };
        
        function setupVMMethods() {
          
            vm.openActivitiesFromDate = function($event) {
              $event.preventDefault();
              $event.stopPropagation();

              vm.openedFromDate = true;   
            };
            
            vm.openActivitiesToDate = function($event) {
              $event.preventDefault();
              $event.stopPropagation();

              vm.openedToDate = true;
            };
            
            vm.gridOptionsActivityResultsTable = {
                enableRowSelection: true,
                enableCellEditOnFocus:true,
                enableGridMenu:true,
                //enableRowSelection: true,
                //enableRowHeaderSelection: false,
                enableHorizontalScrollbar: 1,
                multiSelect: false,
                rowHeight: 45,
                //showGridFooter:true,
                //enableFooterTotalSelected:true,
                enableSorting:false,
                exporterMenuPdf: false,
                exporterMenuCsv: false,
                gridMenuCustomItems: [
                    {
                      title: 'Hide Empty Columns',
                      action: function () {
                        vm.toggleEmptyColumns(); 
                      }
                    },
                    {
                      title: 'Reset Columns',
                      action: function () {
                        vm.taskSearch(); 
                      }
                    }
                ],    
            }; 
             
            
            vm.clear = function () {
                vm.userid = '';
                vm.activityType = '';
                vm.fromDate = '';
                vm.toDate = '';
            };
            
            
            vm.activitySearch = function () {
                
                vm.displayActivitesResults = true;
                
                AdminJsonService.getActivitySearchResults().then(function(data) {

                    var myData = UiGridUtilService.extractTableCellValues(data.tableRows);
                    vm.gridOptionsActivityResultsTable.data = myData;

                    var colDefs = UiGridUtilService.extractColumnDefs(data.tableRows);
                    colDefs = UiGridUtilService.autoColWidth(colDefs, data.tableRows.rowMetaData);

                    vm.gridOptionsActivityResultsTable.columnDefs = colDefs;
                    vm.gridOptionsActivityResultsTable.exporterCsvFilename = 'activities.csv';

                });
            };

        };
        
        
}]);


